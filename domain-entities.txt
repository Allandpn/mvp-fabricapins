===== ARQUIVO: ./src/main/java/com/finalphase/fabricapins/domain/entities/Categoria.java =====
@Entity
@Getter
@NoArgsConstructor
@EqualsAndHashCode(onlyExplicitlyIncluded = true)
@Table(name = "tb_categoria")
public class Categoria {

    @Id
    @GeneratedValue(strategy = GenerationType.IDENTITY)
    private Long id;

    @Setter
    @NotBlank
    @Column(nullable = false, length = 100)
    private String nome;

    @Setter
    @Column(nullable = false)
    private String descricao;

    @Setter
    @Column(nullable = false)
    private boolean ativa = true;

    @OneToMany(mappedBy = "categoria")
    private List<Produto> produtos = new ArrayList<>();

    public Categoria(String nome, String descricao) {
        this.nome = nome;
        this.descricao = descricao;
    }
}



===== ARQUIVO: ./src/main/java/com/finalphase/fabricapins/domain/entities/Cliente.java =====
@Entity
@Table(name = "tb_cliente")
@Getter
@NoArgsConstructor(access = AccessLevel.PROTECTED)
@EqualsAndHashCode(onlyExplicitlyIncluded = true)
public class Cliente {

    @Id
    @EqualsAndHashCode.Include
    @GeneratedValue(strategy = GenerationType.IDENTITY)
    private Long id;

    @Setter
    @NotBlank
    @Column(nullable = false, length = 150)
    private String nome;

    @Setter
    @Column(length = 11, unique = true, nullable = false)
    @CPF
    private String cpf;

    @Setter
    @CNPJ
    private String cnpj;

    @Setter
    @Email
    @Column(nullable = false, unique = true)
    private String email;

    @Setter
    private String telefone;

    @Setter
    @Column(nullable = false)
    @Enumerated(EnumType.STRING)
    private TipoCliente tipoCliente;


    @CreationTimestamp
    @Column(nullable = false, updatable = false)
    private Instant dataCadastro;

    @UpdateTimestamp
    private Instant dataAtualizacao;

    @Setter
    @Column(nullable = false)
    private boolean ativo = true;

    @OneToOne(mappedBy = "cliente")
    private Usuario usuario;

    @OneToMany(mappedBy = "cliente", fetch = FetchType.LAZY)
    @BatchSize(size = 20)
    private List<Pedido> pedidos = new ArrayList<>();

    @OneToMany(mappedBy = "cliente", fetch = FetchType.LAZY, cascade = CascadeType.ALL, orphanRemoval = true)
    @BatchSize(size = 5)
    private List<Endereco> enderecos = new ArrayList<>();

    public Cliente(String nome, String email, String cpf, TipoCliente tipoCliente) {
        this.nome = nome;
        this.email = email;
        this.cpf = cpf;
        this.tipoCliente = tipoCliente;
    }
}



===== ARQUIVO: ./src/main/java/com/finalphase/fabricapins/domain/entities/CupomDesconto.java =====
@Entity
@Getter
@NoArgsConstructor
@EqualsAndHashCode(onlyExplicitlyIncluded = true)
@Table(name = "tb_cupom_desconto")
public class CupomDesconto {

    @Id
    @GeneratedValue(strategy = GenerationType.IDENTITY)
    private Long id;

    @Setter
    @Column(nullable = false, unique = true)
    private String codigo;

    @Setter
    @Column(nullable = false)
    private boolean ativo = true;

    @Setter
    @Column(nullable = false, precision = 15, scale = 2)
    private BigDecimal valorDesconto;

    @Setter
    @Column(nullable = false)
    @Enumerated(EnumType.STRING)
    private TipoDesconto tipoDesconto;

    @Setter
    private LocalDate dataValidade;

    @Setter
    private Integer quantidadeMinimaItens;

    @Setter
    @Column(precision = 15, scale = 2)
    private BigDecimal valorMinimoPedido;

    @Setter
    @Column(nullable = false)
    private Integer limiteUsos;

    @OneToMany(mappedBy = "id.cupomDesconto")
    private Set<PedidoCupom> pedidoCupomSet = new HashSet<>();

    public CupomDesconto(String codigo, BigDecimal valorDesconto, TipoDesconto tipoDesconto, LocalDate dataValidade, Integer quantidadeMinimaItens, BigDecimal valorMinimoPedido, Integer limiteUsos) {
        this.codigo = codigo;
        this.valorDesconto = valorDesconto;
        this.tipoDesconto = tipoDesconto;
        this.dataValidade = dataValidade;
        this.quantidadeMinimaItens = quantidadeMinimaItens;
        this.valorMinimoPedido = valorMinimoPedido;
        this.limiteUsos = limiteUsos;
    }
}



===== ARQUIVO: ./src/main/java/com/finalphase/fabricapins/domain/entities/Endereco.java =====
@Entity
@Table(name = "tb_endereco")
@Getter
@NoArgsConstructor(access = AccessLevel.PROTECTED)
@EqualsAndHashCode(onlyExplicitlyIncluded = true)
public class Endereco {

    @Id
    @EqualsAndHashCode.Include
    @GeneratedValue(strategy = GenerationType.IDENTITY)
    private Long id;

    @Setter
    @NotBlank
    @Column(nullable = false, length = 8)
    private String cep;

    @Setter
    @NotBlank
    @Column(nullable = false)
    private String estado;

    @Setter
    @NotBlank
    @Column(nullable = false)
    private String cidade;

    @Setter
    @NotBlank
    @Column(nullable = false)
    private String bairro;

    @Setter
    @NotBlank
    @Column(nullable = false)
    private String logradouro;

    @Setter
    @NotBlank
    @Column(nullable = false)
    private String numero;

    @Setter
    private String complemento;

    @Setter
    private String pontoReferencia;

    @Setter
    private String observacoes;

    @Setter
    @Column(nullable = false)
    private boolean enderecoPrincipal = false;

    @Setter
    @Column(nullable = false)
    @Enumerated(EnumType.STRING)
    private TipoEndereco tipoEndereco;

    @CreationTimestamp
    @Column(nullable = false, updatable = false)
    private Instant dataCadastro;

    @Setter
    private String apelido;

    @ManyToOne(fetch = FetchType.LAZY)
    @JoinColumn(name = "cliente_id", nullable = false)
    private Cliente cliente;

    public Endereco(String cep, String estado, String cidade, String bairro, String logradouro, String numero, String complemento, String pontoReferencia, String observacoes, TipoEndereco tipoEndereco, Instant dataCadastro, String apelido, Cliente cliente) {
        this.cep = cep;
        this.estado = estado;
        this.cidade = cidade;
        this.bairro = bairro;
        this.logradouro = logradouro;
        this.numero = numero;
        this.complemento = complemento;
        this.pontoReferencia = pontoReferencia;
        this.observacoes = observacoes;
        this.tipoEndereco = tipoEndereco;
        this.dataCadastro = dataCadastro;
        this.apelido = apelido;
        this.cliente = cliente;
    }
}



===== ARQUIVO: ./src/main/java/com/finalphase/fabricapins/domain/entities/ItemPedido.java =====
@Entity
@Table(name = "tb_item_pedido")
@Getter
@NoArgsConstructor(access = AccessLevel.PROTECTED)
@EqualsAndHashCode(onlyExplicitlyIncluded = true)
public class ItemPedido {

    @Id
    @EqualsAndHashCode.Include
    @GeneratedValue(strategy = GenerationType.IDENTITY)
    private Long id;

    @Setter
    @Min(1)
    @Column(nullable = false)
    private Integer quantidade;

    @Setter
    @Column(precision = 15, scale = 2, nullable = false)
    private BigDecimal precoUnitario;

    @Setter
    @Column(nullable = false, length = 150)
    private String nomeProdutoSnapshot;

    @Setter
    private String imgProdutoSnapshot;

    @Setter
    private BigDecimal custoUnitarioSnapshot;

    @Setter
    @ManyToOne(fetch = FetchType.LAZY)
    @JoinColumn(name = "pedido_id")
    private Pedido pedido;

    @Setter
    @ManyToOne(fetch = FetchType.LAZY)
    @JoinColumn(name = "produto_variacao_id")
    private ProdutoVariacao produtoVariacao;

    public ItemPedido(Integer quantidade, BigDecimal precoUnitario, String nomeProdutoSnapshot, BigDecimal getCustoUnitarioSnapshot) {
        this.quantidade = quantidade;
        this.precoUnitario = precoUnitario;
        this.nomeProdutoSnapshot = nomeProdutoSnapshot;
        this.custoUnitarioSnapshot = getCustoUnitarioSnapshot;
    }

    // Calcula valores Derivados
    public BigDecimal calcularSubTotal(){
        return precoUnitario.multiply(new BigDecimal(quantidade));
    }
}



===== ARQUIVO: ./src/main/java/com/finalphase/fabricapins/domain/entities/Pagamento.java =====
@Entity
@Table(name = "tb_pagamento")
@Getter
@NoArgsConstructor(access = AccessLevel.PROTECTED)
@EqualsAndHashCode(onlyExplicitlyIncluded = true)
public class Pagamento {

    @Id
    @EqualsAndHashCode.Include
    @GeneratedValue(strategy = GenerationType.IDENTITY)
    private Long id;

    @Setter
    private Instant dataPagamento;

    @Setter
    @Column(nullable = false, precision = 15, scale = 2)
    private BigDecimal valorPago;

    @Setter
    @Column(nullable = false)
    @Enumerated(EnumType.STRING)
    private FormaPagamento formaPagamento;

    @Setter
    @Enumerated(EnumType.STRING)
    @Column(nullable = false)
    private StatusPagamento statusPagamento;

    @Setter
    private String codigoTransacao;

    @Setter
    private String gatewayPagamento;

    @Setter
    private Integer parcelasCartao;

    @Setter
    private Instant dataConfirmacao;

    @Setter
    private String motivoRecusa;

    @OneToOne(mappedBy = "pagamento")
    private Pedido pedido;

    public Pagamento(FormaPagamento formaPagamento) {
        this.formaPagamento = formaPagamento;
        this.statusPagamento = StatusPagamento.PENDENTE;
    }
}



===== ARQUIVO: ./src/main/java/com/finalphase/fabricapins/domain/entities/Pedido.java =====
@Entity
@Table(name = "tb_pedido")
@Getter
@NoArgsConstructor(access = AccessLevel.PROTECTED)
@EqualsAndHashCode(onlyExplicitlyIncluded = true)
public class Pedido {

    //TODO - INCLUIR CAMPO ORIGEM PEDIDO

    @Id
    @EqualsAndHashCode.Include
    @GeneratedValue(strategy = GenerationType.IDENTITY)
    private Long id;

    @CreationTimestamp
    @Column(nullable = false, updatable = false)
    private Instant dataCriacao;

    @UpdateTimestamp
    private Instant dataAtualizacao;

    @Setter
    @Column(nullable = false)
    @Enumerated(EnumType.STRING)
    private StatusPedido statusPedido;

    @Setter
    @Column(nullable = false)
    @Enumerated(EnumType.STRING)
    private OrigemPedido origemPedido;

    @Column(precision = 15, scale = 2, nullable = false)
    private BigDecimal valorTotal = BigDecimal.ZERO;

    @Setter
    @Column(precision = 15, scale = 2, nullable = false)
    private BigDecimal valorSubtotal = BigDecimal.ZERO;

    @Setter
    @Column(precision = 15, scale = 2)
    private BigDecimal desconto;

    @Setter
    @Column(nullable = false, unique = true, length = 50)
    private String numeroPedido;

    @Setter
    @Column(precision = 15, scale = 2)
    private BigDecimal valorFrete;

    @Setter
    private LocalDate dataPrevistaProducao;

    @Setter
    private LocalDate dataConclusaoPedido;

    @Setter
    private LocalDate dataEnvio;

    @Setter
    private LocalDate dataEntrega;

    // Dados do cliente snapshot
    @Setter
    @Column(nullable = false)
    private String nomeClienteSnapshot;
    @Setter
    @Column(nullable = false)
    private String cpfCnpjClienteSnapshot;

    // Endereco snapshot
    @Setter
    @Column(nullable = false)
    private String cep;
    @Setter
    @Column(nullable = false)
    private String estado;
    @Setter
    @Column(nullable = false)
    private String cidade;
    @Setter
    @Column(nullable = false)
    private String bairro;
    @Setter
    @Column(nullable = false)
    private String logradouro;
    @Setter
    @Column(nullable = false)
    private Integer numero;
    @Setter
    private String complemento;

    @ManyToOne(fetch = FetchType.LAZY)
    @JoinColumn(name = "cliente_id", nullable = false)
    private Cliente cliente;

    @OneToOne(cascade = CascadeType.ALL, orphanRemoval = true)
    @JoinColumn(name = "pagamento_id")
    private Pagamento pagamento;

    @OneToMany(mappedBy = "pedido", cascade = CascadeType.ALL, orphanRemoval = true, fetch = FetchType.LAZY)
    @BatchSize(size = 20)
    private List<ItemPedido> itemsPedido = new ArrayList<>();

    @OneToMany(mappedBy = "id.pedido")
    private Set<PedidoCupom> pedidoCupomSet = new HashSet<>();

    public Pedido(Cliente cliente, String numeroPedido) {
        this.cliente = cliente;
        this.numeroPedido = numeroPedido;
        this.statusPedido = StatusPedido.AGUARDANDO_PAGAMENTO;
        this.valorTotal = BigDecimal.ZERO;
        this.valorSubtotal = BigDecimal.ZERO;
    }

    // HELPERS
    public void adicionarItem(ItemPedido item){
        itemsPedido.add(item);
        item.setPedido(this);
        recalcularTotal();
    }

    public void removerItem(ItemPedido item){
        itemsPedido.remove(item);
        item.setPedido(null);
        recalcularTotal();
    }

    private  void recalcularTotal(){
        BigDecimal subTotal = itemsPedido.stream()
                .map(ItemPedido::calcularSubTotal)
                .reduce(BigDecimal.ZERO, BigDecimal::add);
        BigDecimal desc = desconto != null ? desconto : BigDecimal.ZERO;
        this.valorTotal = subTotal
                .subtract(desc)
                .add(valorFrete != null ? valorFrete : BigDecimal.ZERO);
        this.valorSubtotal = subTotal;
    }
}



===== ARQUIVO: ./src/main/java/com/finalphase/fabricapins/domain/entities/PedidoCupom.java =====
@Entity
@Table(name = "tb_pedido_cupom")
@Getter
@Setter
@NoArgsConstructor
@EqualsAndHashCode(onlyExplicitlyIncluded = true)
public class PedidoCupom {

    @EmbeddedId
    @EqualsAndHashCode.Include
    private PedidoCupomPK id = new PedidoCupomPK();

    private LocalDate dataAplicacao;

    private BigDecimal valorDescontoAplicado;


}



===== ARQUIVO: ./src/main/java/com/finalphase/fabricapins/domain/entities/PedidoCupomPK.java =====
@Setter
@Getter
@EqualsAndHashCode
@NoArgsConstructor
@Embeddable
public class PedidoCupomPK {

    @ManyToOne
    @JoinColumn(name = "pedido_id")
    private Pedido pedido;

    @ManyToOne
    @JoinColumn(name = "cupom_desconto_id")
    private CupomDesconto cupomDesconto;


}



===== ARQUIVO: ./src/main/java/com/finalphase/fabricapins/domain/entities/Perfil.java =====
@Entity
@Table(name = "tb_perfil")
@Getter
@NoArgsConstructor
@EqualsAndHashCode(onlyExplicitlyIncluded = true)
public class Perfil {

    @Id
    @EqualsAndHashCode.Include
    @GeneratedValue(strategy = GenerationType.IDENTITY)
    private Long id;

    @Setter
    @Column(nullable = false, unique = true, length = 50)
    private String nome;

    @ManyToMany(mappedBy = "perfis")
    private Set<Usuario> usuarios = new HashSet<>();

    public Perfil(String nome) {
        this.nome = nome;
    }

}



===== ARQUIVO: ./src/main/java/com/finalphase/fabricapins/domain/entities/Produto.java =====
@Entity
@Table(name = "tb_produto")
@Getter
@NoArgsConstructor(access = AccessLevel.PROTECTED)
@EqualsAndHashCode(onlyExplicitlyIncluded = true)
public class Produto {

    @Id
    @EqualsAndHashCode.Include
    @GeneratedValue(strategy = GenerationType.IDENTITY)
    private Long id;

    @Setter
    @NotBlank
    @Column(nullable = false, length = 150)
    private String nome;

    @Setter
    @Column(columnDefinition = "TEXT")
    private String descricao;

    @Setter
    @NotBlank
    @Column(nullable = false)
    @Enumerated(EnumType.STRING)
    private TipoEstoqueProduto tipoEstoque;

    @Setter
    @NotBlank
    @Column(precision = 15, scale = 2, nullable = false)
    private BigDecimal precoVarejo;

    @Setter
    @NotBlank
    @Column(precision = 15, scale = 2, nullable = false)
    private BigDecimal precoRevenda;

    @Setter
    @NotBlank
    @Column(precision = 15, scale = 2, nullable = false)
    private BigDecimal custoProducao;

    @Setter
    private String imgUrl;

    @Setter
    @NotBlank
    @Column(unique = true, length = 100)
    private String sku;

    @CreationTimestamp
    @Column(nullable = false, updatable = false)
    private Instant dataCadastro;

    @UpdateTimestamp
    private Instant dataAtualizacao;

    @Setter
    private boolean destaque = false;

    @Setter
    private boolean ativo = true;

    @OneToMany(mappedBy = "produto", fetch = FetchType.LAZY, cascade = CascadeType.ALL, orphanRemoval = true)
    @BatchSize(size = 20)
    private List<ProdutoVariacao> produtosVariacao = new ArrayList<>();

    @ManyToOne(fetch = FetchType.LAZY)
    @JoinColumn(name = "categoria_id", nullable = false)
    private Categoria categoria;

    public Produto(String nome, TipoEstoqueProduto tipoEstoque,
                   BigDecimal precoVarejo, BigDecimal precoRevenda, BigDecimal custoProducao) {
        this.nome = nome;
        this.tipoEstoque = tipoEstoque;
        this.precoVarejo = precoVarejo;
        this.precoRevenda = precoRevenda;
        this.custoProducao = custoProducao;
    }

    //HELPERS
    public void adicionarProdutoVariacao(ProdutoVariacao prodV){
        produtosVariacao.add(prodV);
        prodV.setProduto(this);
    }

    public void removerProdutoVariacao(ProdutoVariacao prodV){
        produtosVariacao.remove(prodV);
        prodV.setProduto(null);
    }

}



===== ARQUIVO: ./src/main/java/com/finalphase/fabricapins/domain/entities/ProdutoVariacao.java =====
@Entity
@Table(name = "tb_produto_variacao")
@Getter
@NoArgsConstructor(access = AccessLevel.PROTECTED)
@EqualsAndHashCode(onlyExplicitlyIncluded = true)
public class ProdutoVariacao {

    @Id
    @EqualsAndHashCode.Include
    @GeneratedValue(strategy = GenerationType.IDENTITY)
    private Long id;

    @Setter
    @NotBlank
    @Column(nullable = false, length = 100)
    private String nome;

    @Setter
    @Column(columnDefinition = "TEXT")
    private String descricao;

    @Setter
    @Min(0)
    @NotBlank
    @Column(nullable = false)
    private Integer quantidadeEstoque;

    @Setter
    @Min(0)
    @NotBlank
    @Column(nullable = false)
    private Integer estoqueMinimo;

    @Setter
    @NotBlank
    @Column(nullable = false, length = 100)
    private String sku;

    @Setter
    private String imgUrl;

    @Setter
    @ManyToOne(fetch = FetchType.LAZY)
    @JoinColumn(name = "produto_id", nullable = false)
    private Produto produto;

    @OneToMany(mappedBy = "produtoVariacao", fetch = FetchType.LAZY)
    @BatchSize(size = 20)
    private List<ItemPedido> itemsPedido = new ArrayList<>();

    public ProdutoVariacao(String nome, Integer quantidadeEstoque, Integer estoqueMinimo, Produto produto) {
        this.nome = nome;
        this.quantidadeEstoque = quantidadeEstoque;
        this.estoqueMinimo = estoqueMinimo;
        this.produto = produto;
    }

    // HELPERS
    public void reduzirEstoque(int quantidade){
        if(quantidade > this.getQuantidadeEstoque()){
            throw new IllegalStateException("Estoque insuficiente");
        }
        this.quantidadeEstoque -= quantidade;
    }
}



===== ARQUIVO: ./src/main/java/com/finalphase/fabricapins/domain/entities/Usuario.java =====
@Entity
@Table(name = "tb_usuario")
@Getter
@NoArgsConstructor
@EqualsAndHashCode(onlyExplicitlyIncluded = true)
public class Usuario {

    @Id
    @EqualsAndHashCode.Include
    @GeneratedValue(strategy = GenerationType.IDENTITY)
    private Long id;

    @Setter
    @NotBlank
    @Column(unique = true, nullable = false, length = 100)
    private String username;

    @Setter
    @NotBlank
    @Column(nullable = false)
    private String password;

    @Setter
    @Column(nullable = false)
    private boolean ativo = true;

    @CreationTimestamp
    @Column(nullable = false, updatable = false)
    private Instant dataCriacao;

    @ManyToMany
    @JoinTable(name="tb_perfil_usuario",
            joinColumns = @JoinColumn(name = "usuario_id"),
            inverseJoinColumns = @JoinColumn(name = "perfil_id"))
    private Set<Perfil> perfis = new HashSet<>();

    // TODO Confirmar se todo usuario sera cliente
    @OneToOne
    @JoinColumn(name = "cliente_id", unique = true)
    private Cliente cliente;

    public Usuario(String username, String password) {
        this.username = username;
        this.password = password;
    }
}



